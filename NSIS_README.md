# Создание установщика с помощью NSIS

NSIS (Nullsoft Scriptable Install System) - это популярный инструмент для создания традиционных `.exe` установщиков для Windows.

## Преимущества NSIS

- ✅ **Не требует сертификатов** - установщик работает без установки сертификатов
- ✅ **Работает везде** - совместим со всеми версиями Windows
- ✅ **Простота установки** - пользователи просто запускают `.exe` файл
- ✅ **Гибкая настройка** - можно настроить весь процесс установки

## Установка NSIS

1. Скачайте NSIS с официального сайта: https://nsis.sourceforge.io/Download
2. Установите NSIS (рекомендуется стандартный путь)
3. **ВАЖНО:** Используйте Unicode версию NSIS для корректного отображения русского текста
4. Добавьте NSIS в PATH:
   - Обычно: `C:\Program Files (x86)\NSIS`
   - Или: `C:\Program Files\NSIS`

**Примечание:** Современные версии NSIS по умолчанию Unicode. Скрипт автоматически использует Unicode компилятор `makensis.exe`.

## Быстрый старт

### Автоматическая сборка

```bash
# Windows CMD
build_nsis_installer.bat

# Windows PowerShell
.\build_nsis_installer.ps1
```

Скрипты автоматически:
1. Установят зависимости Flutter
2. Соберут release-версию приложения
3. Создадут NSIS установщик

### Ручная сборка

1. **Соберите приложение:**
   ```bash
   flutter build windows --release
   ```

2. **Скомпилируйте установщик:**
   ```bash
   makensis installer.nsi
   ```

   Или используйте графический интерфейс:
   - Откройте `NSIS Compiler` (makensisw.exe)
   - Перетащите файл `installer.nsi` в окно компилятора

## Настройка установщика

Отредактируйте файл `installer.nsi` для настройки:

### Основные настройки

```nsis
!define APP_NAME "IPTVCA"           # Название приложения
!define APP_VERSION "1.0.0"         # Версия
!define APP_PUBLISHER "IPTVCA"      # Издатель
!define APP_EXECUTABLE "iptvca.exe" # Имя исполняемого файла
!define SOURCE_DIR "build\windows\x64\runner\Release"  # Путь к файлам
```

### Изменение иконок

Замените строки:
```nsis
!define MUI_ICON "путь\к\иконке.ico"
!define MUI_UNICON "путь\к\иконке_удаления.ico"
```

### Изменение директории установки

По умолчанию установка происходит в `C:\Program Files\iptvca`.

Для изменения:
```nsis
InstallDir "$PROGRAMFILES\${APP_DIR}"  # Program Files
InstallDir "$LOCALAPPDATA\${APP_DIR}"  # AppData\Local
InstallDir "$DESKTOP\${APP_DIR}"       # Рабочий стол
```

## Структура скрипта

- **Секция SecMain** - устанавливает основные файлы приложения
- **Секция SecShortcuts** - создает ярлыки на рабочем столе и в меню Пуск
- **Секция Uninstall** - удаляет приложение

## Что устанавливается

Установщик копирует:
- Исполняемый файл (`iptvca.exe`)
- Все DLL файлы
- Папку `data` с ресурсами Flutter
- Папку `flutter_assets` (если существует)
- Папку `native_assets` (если существует)

## Ярлыки

Автоматически создаются:
- Ярлык на рабочем столе
- Ярлык в меню Пуск
- Ярлык для удаления в меню Пуск

## Удаление

Приложение можно удалить через:
- Панель управления → Программы → Удаление программ
- Ярлык "Удалить IPTVCA" в меню Пуск
- Файл `Uninstall.exe` в папке установки

## Решение проблем

### Ошибка: "NSIS не найден"
1. Убедитесь, что NSIS установлен
2. Добавьте NSIS в PATH
3. Или укажите полный путь: `"C:\Program Files (x86)\NSIS\makensis.exe" installer.nsi`

### Ошибка: "Файлы сборки не найдены"
1. Соберите приложение: `flutter build windows --release`
2. Убедитесь, что файлы находятся в `build\windows\x64\runner\Release\`

### Установщик не запускается
- Проверьте антивирус (может блокировать самоподписанные установщики)
- Попробуйте запустить от имени администратора

## Дополнительные ресурсы

- [Документация NSIS](https://nsis.sourceforge.io/Docs/)
- [Руководство по созданию скриптов](https://nsis.sourceforge.io/Docs/)
- [Примеры скриптов](https://nsis.sourceforge.io/Examples/)

